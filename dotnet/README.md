# Monitoring/Logging containerized .NET application with Datadog

- With Autodiscovery feature of Datadog, containers were auto-discovered
and monitored when Autodiscovery is enabled. Output from container's stdout/stderr will get shipped to Datadog automatically.
- Log file generated by application (i.e. /var/log/mylog.json) will not get shipped unless proper configuration is applied. See ConfigMap in alpha.yaml and datadog-agent.yaml file those required configuration.

> Usefule Links
> - https://docs.datadoghq.com/logs/log_collection/csharp
> - https://docs.datadoghq.com/agent/kubernetes/log

## Folder and File Structure
 - *Dockerfile* builds a docker image of .NET application
 - *myapp3* contained .NET application
 - *alpha.yaml* contained manifest to deploy .NET app in a K8S cluster
 - *datadog-agent.yaml* contained manifest to deploy Datadog agent in a K8S cluster
   (Note that Datadog agent may be configured in many different ways. This manifest should be a reference point as to what need to be configured to get tailing/shipping application's log file to Datadog.)

> See [k8s](../k8s) folder for monitoring Kubernetes cluster with Datadog

## Example
The following example assumed an existing AKS cluster. To quickly spin up one, see [aks-playground](https://github.com/openrba/aks-playground)

 - Build docker image
 ```
 cd dotnet
 docker build -t <Docker-hub-username>/alpha .
 ```

 - Publish the image to Docker Hub
 ```
 docker image build <Docker-hub-username>/alpha
 ```

 - Deploy app to AKS cluster
 ```
 cd monitoring-with-datadog/dotnet
 terraform init
 terraform plan
 terraform apply -auto-approve
 ```

 - View metrics in Datadog
   Go to [Kubernetes Dashboard](https://app.datadoghq.com/screen/integration/86/kubernetes) in Datadog portal

 - Clean up
 ```
 terraform destroy -auto-approve
 ```
